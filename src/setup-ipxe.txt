#!ipxe

sync --timeout 500

prompt --key 0x02 --timeout 5000 Press Ctrl-B for the iPXE command line... && shell ||

set idx:int32 0
set domain yandex.net yandex.ru
set dns6 2a02:6b8::1:1
set server setup.search.yandex.net

echo [Setup img/iso] Trying to boot...

ifopen && isset ${gateway} && chain http://${server}/PXE/iboot.ipxe/${mac} ||

:loop isset ${net${idx}/mac} || goto fail
  ifconf -c ipv6 net${idx} && chain http://${server}/PXE/iboot.ipxe/${net${idx}/mac} ||
  chain http://netboot.yandex.net/setup-netboot/${net${idx}/mac} ||
  ifconf -c dhcp net${idx} && chain http://${server}/PXE/iboot.ipxe/${net${idx}/mac} ||

  inc idx && goto loop

:fail

echo Autoconfiguration has failed

prompt --key 0x02 --timeout 5000 Press Ctrl-B for the iPXE command line... && shell ||
sanboot --no-describe --drive 0x80 ||

exit 0
